#!/bin/bash

# Имя файла, в который будут собраны все данные.
OUTPUT_FILE="project_content.txt"

# Имя самого скрипта для его исключения из сборки.
SCRIPT_NAME="./$(basename "$0")"

# Очищаем или создаем выходной файл.
> "$OUTPUT_FILE"

echo "Начинаю сборку файлов в $OUTPUT_FILE..."
echo "Исключаю все скрытые файлы и папки (начинающиеся с точки)..."

# Ключевое изменение здесь в команде find:
# -path '*/.*' -prune: находит любой путь, где компонент начинается с точки, и не входит в него.
# -o: логическое "ИЛИ"
# -type f: из оставшихся путей выбирает только файлы.
# Исключаем также сам скрипт и итоговый файл на случай, если они не попали под первое правило.
find . -path '*/.*' -prune -o -type f ! -name "$(basename "$0")" ! -name "$OUTPUT_FILE" -print0 | while IFS= read -r -d $'\0' file; do

    # Добавляем заголовок с путем и именем файла.
    echo "==================== НАЧАЛО: $file ====================" >> "$OUTPUT_FILE"
    echo "" >> "$OUTPUT_FILE"

    # Добавляем содержимое файла.
    cat "$file" >> "$OUTPUT_FILE"

    # Добавляем разделитель в конце.
    echo "" >> "$OUTPUT_FILE"
    echo "==================== КОНЕЦ: $file ======================" >> "$OUTPUT_FILE"
    
    # Добавляем отступы для читаемости.
    echo "" >> "$OUTPUT_FILE"
    echo "" >> "$OUTPUT_FILE"
done

echo "Готово! Содержимое проекта собрано в $OUTPUT_FILE."
